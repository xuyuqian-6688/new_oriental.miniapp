{"version":3,"sources":["uni-app:///main.js","webpack:////Users/cota/Documents/cootaa/neworiental/pages/activity/index.vue?3a8f","webpack:////Users/cota/Documents/cootaa/neworiental/pages/activity/index.vue?169f","webpack:////Users/cota/Documents/cootaa/neworiental/pages/activity/index.vue?dcfa","webpack:////Users/cota/Documents/cootaa/neworiental/pages/activity/index.vue?cd99","uni-app:///pages/activity/index.vue","webpack:////Users/cota/Documents/cootaa/neworiental/pages/activity/index.vue?8d61"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","_isMounted","e0","$event","dropDownVisible","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;wEAAA,qBACA,sBACA,4C,mDACAA,EAAWC,a;;;;2DCHX,0SACIC,EADJ,qMASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,2BACZ,aAAAF,E;;;;2GCvBf,qzC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,GACdL,EAAIM,aACPN,EAAIO,GAAK,SAASC,GAChBR,EAAIS,iBAAmBT,EAAIS,mBAI7BC,GAAmB,EACnBC,EAAkB,GACtBZ,EAAOa,eAAgB,G;;;;2DCbvB,y4BAAm1B,eAAG,G;;;;0ICsDt1B,uBACA,2B,+jCAGA,CACE,WAAF,CACI,YAAJ,EACI,cAAJ,GAEE,KALF,WAMI,MAAJ,CACM,YAAN,SACM,QAAN,GACM,aAAN,GACM,iBAAN,EACM,KAAN,EACM,KAAN,IAGE,SAAF,MACE,EAAF,2CAEE,QAlBF,WAmBI,KAAJ,mCAGE,kBAtBF,WAuBI,EAAJ,sBACI,KAAJ,mCAGE,cA3BF,WA4BI,KAAJ,6CAEE,QAAF,CACI,QADJ,SACA,kBACM,EAAN,aACQ,MAAR,SAEM,EAAN,qEAGQ,GAFA,EAAR,cACQ,EAAR,OACA,MACU,EAAV,0CAEY,OADA,EAAZ,2DACA,UAGU,GAAV,oBACY,IAAZ,+BAEc,OADA,EAAd,2DACA,KAEY,EAAZ,OACY,EAAZ,2CAEY,EAAZ,WACc,MAAd,UACc,KAAd,OACc,SAAd,SAIA,mBACQ,QAAR,WAGI,aAjCJ,SAiCA,GACM,KAAN,UACM,KAAN,wBAEI,YArCJ,SAqCA,GACM,IAAN,OACM,EAAN,OACQ,QADR,SACA,GACU,GAAV,OACY,GAAZ,sBAEc,IAAd,uBACc,EAAd,4BACc,EAAd,UACgB,KAAhB,OACgB,SAAhB,WACgB,OAAhB,YACgB,QAAhB,UACgB,SAAhB,WACgB,KAAhB,OACgB,OAAhB,SACgB,SAAhB,aACc,MAAd,YACgB,EAAhB,cAEgB,EAAhB,8CACgB,EAAhB,mDACgB,EAAhB,4BACgB,EAAhB,sCACA,mBACgB,QAAhB,eAIc,EAAd,WACgB,MAAhB,KACgB,QAAhB,mBACgB,YAAhB,EACgB,YAAhB,OACgB,QAAhB,YACA,WACoB,QAApB,2BAMY,QAAZ,0BAKI,eArFJ,SAqFA,GACM,IAAN,OAEM,EAAN,cACQ,QADR,WAEU,QAAV,wBAGQ,KALR,WAMU,QAAV,wBAEU,EAAV,OACY,QADZ,SACA,GACA,QAEgB,EAAhB,yBACgB,EAAhB,+BAEgB,EAAhB,UACkB,KAAlB,SACgB,MAAhB,YAEkB,EAAlB,8CACkB,EAAlB,sDACA,mBACkB,QAAlB,WAGgB,QAAhB,0BAKQ,SA9BR,WA+BA,2BACY,EAAZ,oBACc,YAAd,eACc,cAAd,0BACc,GAAd,iBACY,MAAZ,YACc,EAAd,4BACc,EAAd,WACgB,MAAhB,OACgB,KAAhB,eAEA,mBACc,QAAd,UAIY,EAAZ,WACc,MAAd,KACc,QAAd,6BACc,YAAd,EACc,YAAd,OACc,QAAd,YACA,WACkB,QAAlB,0BAQI,UAtJJ,SAsJA,GACM,KAAN,mBACM,KAAN,6B;;;;2DChPA,ilDAAoiD,eAAG,G","file":"pages/activity/index.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/activity/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=6362e18b&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=6362e18b&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6362e18b\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/activity/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=6362e18b&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.dropDownVisible = !_vm.dropDownVisible\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n    <div>\n        <navigation-bar></navigation-bar>\n        <div class=\"m_container p-1\" :style=\"{'padding-top':(menuButton.bottom + 10)+'px'}\">\n            <div class=\"mb-1 flex-row justify-between align-center\">\n                <div class=\"title\">活动专区</div>\n                <div class=\"classify\">\n                    <div class=\"flex-row align-center\" @click=\"dropDownVisible = !dropDownVisible\">\n                        <div class=\"mr-1\">{{ type === 1 ? '近期活动' : '往期活动' }}</div>\n                        <img class=\"icon\" src=\"/static/images/arrow-bottom.png\" alt=\"\">\n                    </div>\n                    <div v-if=\"dropDownVisible\" class=\"dropDown\">\n                        <div class=\"dropDown-item\" @click=\"checkType(1)\">\n                            近期活动\n                        </div>\n                        <div class=\"dropDown-item\" @click=\"checkType(0)\">\n                            往期活动\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"mb-1\">\n                <search-input @input=\"searchSchool\" :placeholder=\"placeholder\"></search-input>\n            </div>\n            <div v-if=\"activityList.length\" class=\"activity-list\">\n                <div v-for=\"(item, index) in activityList\" :key=\"index\" class=\"activity-item mb-1\">\n                    <img class=\"activity-img mb-1\" mode=\"aspectFill\" :src=\"item.image_url ? item.image_url :''\" alt=\"活动封面\">\n                    <div class=\"flex-row align-center\">\n                        <div class=\"flex-1 mr-1\">\n                            <div class=\"sub-title\">\n                                {{ item.name }}\n                            </div>\n                            <div class=\"color-grey\">\n                                活动时间： {{ item.start_time  }}\n                            </div>\n                        </div>\n                        <div>\n                            <button v-if=\"!hasUserInfo\" class=\"btn btn-primary btn-sm\" open-type=\"getUserInfo\" @getuserinfo=\"getUserInfo\" :data-id=\"item.id\">预约</button>\n                            <button v-else-if=\"!item.user.length && type!==0\" class=\"btn btn-primary btn-sm\" :id=\"item.id\" open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\">预约</button>\n                            <button v-else class=\"btn btn-primary btn-sm\" :class=\"{'expired' : type === 0 || item.user.length }\">{{ item.user.length ? '已预约' : '已过期' }}</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div v-else style=\"text-align: center\">\n                暂无数据\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport NavigationBar from \"../../components/NavigationBar\";\nimport SearchInput from '../../components/SearchInput'\nimport {mapState} from \"vuex\";\nimport { searchActivity, activityBooking } from '@/api/api.js'\nimport { login } from '@/api/api.js'\n\nexport default {\n    components: {\n        SearchInput,\n        NavigationBar\n    },\n    data () {\n        return {\n            placeholder: '搜索活动名称',\n            keyword: '',\n            activityList: [],\n            dropDownVisible: false,\n            type: 1, // 0是往期 其他默认是近期\n            page: 1,\n        }\n    },\n    computed: {\n        ...mapState(['menuButton', 'hasUserInfo'])\n    },\n    mounted () {\n        this.getList(1, this.type, this.keyword)\n    },\n    // 下拉刷新\n    onPullDownRefresh() {\n        uni.stopPullDownRefresh() // 解决无法回弹\n        this.getList(1, this.type, this.keyword)\n    },\n    // 上拉加载，拉到底部触发\n    onReachBottom() {\n        this.getList(this.page+1, this.type, this.keyword)\n    },\n    methods: {\n        getList(page, activity_time, name) {\n            uni.showLoading({\n                title: '加载中'\n            })\n            searchActivity({page, activity_time, name: name }).then( res => {\n                uni.hideLoading()\n                this.type = activity_time\n                if (page === 1) {\n                    this.activityList = res.data.data.map( item => {\n                        item.start_time = new Date(item.start_time*1000).toLocaleDateString()\n                        return item\n                    })\n                } else {\n                    if (res.data.data.length) {\n                        const temp = res.data.data.map( item => {\n                        item.start_time = new Date(item.start_time*1000).toLocaleDateString()\n                            return item\n                        })\n                        this.page = page\n                        this.activityList = this.activityList.concat(temp)\n                    } else {\n                        uni.showToast({\n                            title: '没有更多数据了',\n                            icon: 'none',\n                            duration: 2000\n                        })\n                    }\n                }\n            }).catch( err => {\n                console.log(err)\n            })\n        },\n        searchSchool(val) {\n            this.keyword = val\n            this.getList(1, this.type, val)\n        },\n        getUserInfo(e) {\n            const that = this\n            uni.login({\n                success (res) {\n                    if (res.code) {\n                        if (e.mp.detail.userInfo) {\n                            // 用户按了允许授权按钮\n                            const userInfo = e.mp.detail.userInfo\n                            uni.showLoading({title: '登录中'})\n                            login({\n                                code: res.code,\n                                nickname: userInfo.nickName,\n                                avatar: userInfo.avatarUrl,\n                                country: userInfo.country,\n                                province: userInfo.province,\n                                city: userInfo.city,\n                                gender: userInfo.gender,\n                                language: userInfo.language\n                            }).then( res => {\n                                uni.hideLoading()\n                                // 保存access_token\n                                that.$store.state.access_token = res.data.access_token\n                                uni.setStorageSync('access_token', res.data.access_token)\n                                that.$store.state.hasUserInfo = true\n                                uni.setStorageSync('has_user_info', true)\n                            }).catch( err => {\n                                console.log(err)\n                            })\n                        } else {\n                            // 用户按了拒绝按钮\n                            uni.showModal({\n                                title: '提示',\n                                content: '为了更好的用户体验，请同意授权！',\n                                showCancel: false,\n                                confirmText: '返回授权',\n                                success: function(res) {\n                                    if (res.confirm) {\n                                        console.log('用户点击了“返回授权”')\n                                    }\n                                }\n                            })\n                        }\n                    } else {\n                        console.log('登录失败！' + res.errMsg)\n                    }\n                }\n            })\n        },\n        getPhoneNumber(e) {\n            const that = this\n            // 判断登录态\n            uni.checkSession({\n                success () {\n                    console.log('session_key 未过期')\n                    //session_key 未过期，并且在本生命周期一直有效\n                },\n                fail () {\n                    console.log('session_key 已经失效')\n                    // session_key 已经失效，需要重新执行登录流程\n                    uni.login({\n                        success (res) {\n                            if (res.code) {\n                                // 保存code\n                                that.$store.state.code = res.code\n                                uni.setStorageSync('code', res.code)\n                                // 登录 更新后端session_key\n                                login({ \n                                    code: res.code\n                                }).then( res => {\n                                    // 保存access_token\n                                    that.$store.state.access_token = res.data.access_token\n                                    uni.setStorageSync('access_token', res.data.access_token)\n                                }).catch( err => {\n                                    console.log(err)\n                                })\n                            } else {\n                                console.log('登录失败！' + res.errMsg)\n                            }\n                        }\n                    })\n                },\n                complete () {\n                    if (e.mp.detail.encryptedData) {\n                        activityBooking({\n                            activity_id: e.mp.target.id,\n                            encryptedData: e.mp.detail.encryptedData,\n                            iv: e.mp.detail.iv\n                        }).then( res => {\n                            that.getList(1, that.type, that.keyword)\n                            uni.showToast({\n                                title: '预约成功',\n                                icon: 'success'\n                            })\n                        }).catch( err => {\n                            console.log(err)\n                        })\n                    } else {\n                        // 用户按了拒绝按钮\n                        uni.showModal({\n                            title: '警告',\n                            content: '您点击了拒绝，将无法预约活动，请允许之后再预约!!!',\n                            showCancel: false,\n                            confirmText: '返回预约',\n                            success: function(res) {\n                                if (res.confirm) {\n                                    console.log('用户点击了“返回预约”')\n                                }\n                            }\n                        })\n                    }\n                }\n            })\n        },\n        checkType(type) {\n            this.dropDownVisible = false\n            this.getList(1, type, this.keyword)\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n    @import \"../../acsset/style/common\";\n\n    .activity-img{\n        width: 100%;\n        border-radius: 0.2em;\n        box-shadow: 0 10px 10px rgba(214, 218,221, 0.5);\n    }\n    .classify{\n        position: relative;\n    }\n    .dropDown{\n        position: absolute;\n        width: 120%;\n        right: 0;\n        top: 1.7em;\n        background-color: #ffffff;\n        box-shadow: 0 10px 10px rgba(214, 218,221, 0.5);\n        border-radius: 0.1em;\n        padding: 0.5em;\n        z-index: 999999;\n    }\n    .dropDown-item{\n        text-align: center;\n        padding: 0.7em 0;\n    }\n    .dropDown-item:nth-child(1) {\n        border-bottom: 1px solid $black;\n    }\n    .expired {\n        background: #eee;\n        color: #4A4A4A;\n        border: 1px solid #4A4A4A;\n    }\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=6362e18b&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=6362e18b&lang=scss&scoped=true&\""],"sourceRoot":""}